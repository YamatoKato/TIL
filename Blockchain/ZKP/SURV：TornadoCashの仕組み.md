# Tornado Cash の仕組み

- 2024/04/29
- キーワード: Blockchain,ZKP,Tornado Cash, Smart Contract, Ethereum

## 概要

Tornado Cash は、イーサリアム上で動作するプライバシー保護型のミキサーサービスです。ユーザーは、Tornado Cash を利用することで、自身のトランザクションのプライバシーを保護することができます

## 処理の流れ

1. ノートの生成
   ユーザーはまず、nullifier（一意の識別子）と secret（秘密の値）を組み合わせて note を生成します。この note は、後で資金を引き出す際に必要となる重要な情報です。
2. デポジット
   ユーザーは、使用しているイーサリアムアドレス（例: 0x111...）から、note のハッシュ値と共に ETH を Tornado Cash のスマートコントラクトに送金します。このとき、note 自体は公開されず、そのハッシュ値のみがブロックチェーンに記録されます。
3. merkle ツリーへの追加
   スマートコントラクトは、受け取った note のハッシュ値を merkle ツリーに追加します。merkle ツリーは、多数のトランザクションを効率的に検証するためのデータ構造です。
4. ゼロ知識証明の生成
   新しいアドレス（例: 0x555...）を使用して ETH を引き出す際、ユーザーは note を保有していることを証明するためにゼロ知識証明（ZKP）を生成します。この証明は、ユーザーが note を持っていることと、その note が merkle ツリー内に存在することを示しますが、note の内容自体は秘密のままです。
5. リレイヤーを通じた引き出し
   ユーザーは、生成した ZKP と nullifier のハッシュをリレイヤーに渡します。リレイヤーはこれらの情報を使って、スマートコントラクトの引き出し関数を実行し、新しいアドレスに ETH を送金します。リレイヤーを使用する理由は、新しいアドレスに ETH がないため、ガス代（トランザクション手数料）を支払うことができないからです。
